========================================
WEBSOCKET SECURITY FIX - QUICK DEPLOY
========================================

PROBLEM: Browser was caching old JavaScript files without API keys

SOLUTION: Updated version parameter in HTML templates to force browser reload

RUN THESE COMMANDS ON SERVER:
========================================

cd /var/www/scan2food
git add -A
git commit -m "Fix WebSocket security - update version parameter to force cache refresh"
git push origin main

# Then on server:
cd /var/www/scan2food
git pull origin main
cd application/scan2food
source venv/bin/activate

# Remove old cached static files
rm -rf /var/www/scan2food/static/theatre_js/live-orders/
rm -rf /var/www/scan2food/static/theatre_js/chat-box/
rm -rf /var/www/scan2food/static/theatre_js/all-seat-socket.js
rm -rf /var/www/scan2food/static/theatre_js/payment-socket.js
rm -rf /var/www/scan2food/static/dashboard/

# Collect fresh static files
python manage.py collectstatic --noinput --clear

# Restart services
sudo systemctl restart gunicorn daphne nginx

# Verify API key is in static files
grep "05XnhaghUWM6Hd7YVR6" /var/www/scan2food/static/theatre_js/live-orders/worker.js

========================================
VERIFICATION:
========================================

1. Open browser: https://calculatentrade.com/theatre/live-orders
2. Do HARD REFRESH: Ctrl+Shift+R
3. Open DevTools (F12) → Network tab → WS filter
4. Look for WebSocket connection with URL:
   wss://calculatentrade.com/ws/all-seat-datasocket/?key=05XnhaghUWM6Hd7YVR6_iPcJGfH_YDn3RiDv1Rh-zNM

5. Check Daphne logs:
   sudo journalctl -u daphne -f
   
   Should see: WSCONNECT (not WSREJECT)

========================================
WHAT WAS CHANGED:
========================================

Files modified:
1. application/scan2food/theatre/templates/theatre/live-orders.html
   - Changed: ?v=20260211 → ?v=20260211001

2. application/scan2food/theatre/templates/theatre/all_seats.html
   - Changed: ?v=20260211 → ?v=20260211001

This forces browsers to reload JavaScript files with API keys.

========================================
