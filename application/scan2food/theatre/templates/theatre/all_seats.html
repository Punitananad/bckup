{% extends "theatre/base.html" %}
{% block title %}
<title>
    All Seats
</title>

<meta name="csrf-token" content="{{ csrf_token }}">

{% endblock %}

{% block content %}

{% load static %}
<!-- Modal -->
<!-- menu modal -->
<div class="modal fade bd-example-modal-lg" id="menuePopUp" tabindex="-1" aria-labelledby="menuePopUpLabel"
    aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-scrollable">
        <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fs-5" id="menuePopUpLabel"></h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="container-xxl pb-4 pt-2 p-sm-0">
                    <div class="container p-sm-0">
                        <div class="text-center wow fadeInUp" data-wow-delay="0.1s">
                            <h5 class="section-title ff-secondary text-center text-primary fw-normal mt-0">Our Menu</h5>
                            <h6 class="mb-4">Our Delicious Food Items</h6>
                        </div>
                        <div class="tab-class text-center wow fadeInUp" data-wow-delay="0.1s">
                            <ul class="nav nav-pills d-inline-flex justify-content-center border-bottom mb-5"
                                id="food-category-list">

                                <!-- all catogaries visible here -->

                            </ul>

                            <div class="tab-content" id="food-item-content">

                                <!-- all food items visible here -->


                            </div>
                        </div>
                    </div>

                </div>
            </div>
            <div class="modal-footer d-block">
                <div class="row">
                    <div class="col-lg-6 col-6">
                        <p class="mb-0"> Items added : <span id="cart-length" class=" text-primary fw-bold">0</span>
                        </p>
                        <p class="mb-0">Amount : <span class=" text-primary fw-bold me-1-cust">₹</span><span
                                id="cart-amount" class=" text-primary fw-bold"> 0</span>
                        </p>
                    </div>

                    <div class="col-lg-6 col-md-6 col-6 text-end float-end"> <button class="btn btn-primary"
                            id="cart-div" onclick="openCart(this)">View Cart <i
                                class="bi bi-chevron-right ms-2"></i></button></div>
                </div>
                <!-- cart-panel -->
                <!-- <a class="cart-panel" href="#" >
                    <div class="cart-content">
                        <div class="row">
                            <div class="col text-start">
                                <p class="mb-0"><span id="cart-length">0</span> Items added ; Amount: ₹<span
                                        id="cart-amount">0</span>
                                </p>
                            </div>
                            <div class="col">
                                <p class="mb-0">View Cart <i class="bi bi-chevron-right ms-2"></i></p>
                            </div>
                        </div>

                    </div>
                </a> -->
                <!-- cart-panel -->

            </div>
        </div>
    </div>
</div>


<!-- cart modal -->
<div class="modal fade bd-example-modal-lg" id="cartPopUp" tabindex="-1" aria-labelledby="cartPopUpLabel"
    aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-scrollable">
        <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fs-5" id="cartPopUpLabel"></h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">

                <!-- cart html start here -->

                <div class="container-xxl pb-4 pt-2 p-sm-0">
                    <div class="container p-sm-0">
                        <div class="text-center wow fadeInUp" data-wow-delay="0.1s">
                            <h5 class="section-title ff-secondary text-center text-primary fw-normal mt-0">Your Cart
                            </h5>
                            <h5 class="mb-4">Our Delicious Food Items</h5>
                        </div>
                        <div class="card rounded-2">
                            <div class="card-body">
                                <div class="row gy-3" id="cart-items">
                                    <!-- cards are coming from cart.js -->
                                </div>
                            </div>
                        </div>
                        <div class="row justify-content-end align-items-center">
                            <div class="col-lg-7 col-md-6">
                                <img class="w-50 mt-3" src="{% static 'assets/images/subtotal.png' %}" alt="Sub total">
                            </div>

                            <div class="col-lg-5 col-md-6">
                                <div class="total-section" id="cart-area">
                                    <div class="d-flex justify-content-between mt-3">
                                        <p class=" small">Item(s) Total</p>
                                        <h6 class="price small"><span class="me-1-cust">₹</span><span
                                                id="total-cart-amount" class="amounts">0</span></h6>
                                    </div>

                                    <!-- convenience fee part-->
                                    <div class="convenience-fees">
                                        <div class="d-flex justify-content-between mt-1">
                                            <a class=" cursor-pointer small" data-bs-toggle="collapse"
                                                data-bs-target="#priceBreakdown" aria-expanded="false"
                                                aria-controls="priceBreakdown">
                                                Convenience fees <i class="bi bi-chevron-down"></i>
                                            </a>
                                            <h6 class="price small"><span class="me-1-cust">₹</span><span
                                                    id="convenience-fees" class="amounts small">25.60</span></h6>
                                        </div>

                                        <div class="collapse mt-3" id="priceBreakdown">

                                        </div>
                                    </div>
                                    <!-- convenience fee part-->
                                    <hr>
                                    <div class="d-flex justify-content-between">
                                        <p class=" mb-0 text-dark">Order Total</p>
                                        <h5 class="mb-0"><span class="me-1-cust">₹</span>
                                            <span id="total-amount">0</span>
                                        </h5>
                                    </div>
                                </div>
                            </div>
                        </div>



                    </div>
                </div>


                <!-- cart html end here -->
            </div>
            <div class="modal-footer">
                <div class="row align-items-center text-center justify-content-center">
                    <div class="col-lg-12 col-12 col-md-12 text-end">
                        <button class="btn btn-secondary btn-custom checkout-btn" onclick="backCart()">Go
                            back</button>
                        <button class="btn btn-primary checkout-btn" onclick="createOrder()">Confirm</button>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<!-- order profile modal -->
<div class="modal fade bd-example-modal-lg" id="orderPopUp" tabindex="-1" aria-labelledby="orderPopUpLabel"
    aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fs-5" id="orderPopUpLabel"></h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">

                <!-- order html start here -->
                <div class="container-xxl pb-4 pt-2">
                    <div class="container">
                        <div class="text-center wow fadeInUp" data-wow-delay="0.1s">
                            <h5 class="section-title ff-secondary text-center text-primary fw-normal">Order Summary</h5>
                            <h4 class="mb-5">Order Details</h4>
                        </div>
                        <div class="tab-class text-center wow fadeInUp" data-wow-delay="0.1s"
                            style="visibility: visible; animation-delay: 0.1s; animation-name: fadeInUp;">
                            <ul class="nav nav-pills d-inline-flex justify-content-center border-bottom mb-3" id="myTab"
                                role="tablist">
                                <li class="nav-item" role="presentation">
                                    <a class="d-flex align-items-center text-start mx-3 ms-0 pb-3 active" id="order-tab"
                                        data-bs-toggle="tab" data-bs-target="#order" type="button" role="tab"
                                        aria-controls="order" aria-selected="true">

                                        <i class="far fa-bookmark fa-2x text-primary"></i>
                                        <div class="ps-3">
                                            <h6>Orders</h6>
                                        </div>
                                    </a>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <a class="d-flex align-items-center text-start mx-3 pb-3" id="items-tab"
                                        data-bs-toggle="tab" data-bs-target="#items" type="button" role="tab"
                                        aria-controls="items" aria-selected="false">

                                        <i class="fas fa-list-ul fa-2x text-primary"></i>
                                        <div class="ps-3">
                                            <h6>Items</h6>
                                        </div>
                                    </a>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <a class="d-flex align-items-center text-start mx-3 pb-3" id="payments-tab"
                                        data-bs-toggle="tab" data-bs-target="#payments" type="button" role="tab"
                                        aria-controls="payments" aria-selected="false">
                                        <i class="fa fa-credit-card fa-2x text-primary"></i>
                                        <div class="ps-3">
                                            <h6>Payments</h6>
                                        </div>
                                    </a>
                                </li>
                            </ul>
                        </div>
                        <div class="tab-content" id="myTabContent">
                            <!-- Order Tab Start -->
                            <div class="tab-pane fade show active" id="order" role="tabpanel"
                                aria-labelledby="order-tab">
                                <div class="card rounded-2 mt-4">
                                    <div class="card-body">
                                        <div class="d-flex justify-content-between">
                                            <p class="text-muted">Order ID</p>
                                            <h6 id="order-id">#{{order.id}}</h6>
                                        </div>

                                        <div class="d-flex justify-content-between">
                                            <p class="text-muted">Order Seen</p>

                                            <h6>
                                                <a href="#" id="order-shown" class="text-dark"></a>
                                            </h6>

                                        </div>


                                        <div class="d-flex justify-content-between">
                                            <p class="text-muted">Food Delivered Status.</p>
                                            <h6>
                                                <a href="#" id="delivery-status" class="text-dark">
                                                </a>
                                            </h6>
                                        </div>

                                        <div class="d-flex justify-content-between" id="delivery-detail-box">
                                            <p class="text-muted">Delivery Time</p>
                                            <h6>
                                                <a href="#" id="delivery-detail-box-value" class="text-dark">
                                                </a>
                                            </h6>
                                        </div>


                                        <div class="d-flex justify-content-between">
                                            <p class="text-muted">Seat</p>
                                            <h6 id="seat-name"></h6>
                                        </div>

                                        <div class="d-flex justify-content-between">
                                            <p class="text-muted">Order Date</p>
                                            <h6 id="order-date"></h6>
                                        </div>
                                        <div class="d-flex justify-content-between">
                                            <p class="text-muted">Order Time</p>
                                            <h6 id="order-time"></h6>
                                        </div>

                                        <div class="d-flex justify-content-between">
                                            <p class="text-muted">Phone Number</p>
                                            <h6 id="phone-number"></h6>
                                        </div>

                                        <div class="d-flex justify-content-between">
                                            <p class="text-muted">Payment Status</p>
                                            <h6 id="payment-status"></h6>
                                        </div>

                                        <div class="d-flex justify-content-between">
                                            <p class="text-muted" id="panding-amount-heading">Pending Amount</p>
                                            <h6 class="total-amount">₹ <span id="panding-amount-heading-value"></span>
                                            </h6>
                                        </div>


                                    </div>
                                </div>
                            </div>
                            <!-- Order Tab End -->

                            <!-- Items Tab Start -->
                            <div class="tab-pane fade" id="items" role="tabpanel" aria-labelledby="items-tab">
                                <div class="card rounded-2 mt-4">
                                    <div class="card-body" id="order-items">

                                        <div id="all-tax-area">
                                            {% for tax in theatre.tax_set.all %}
                                            <div class="d-flex justify-content-between">
                                                <p class="text-muted">{{tax.name}} (<span
                                                        class="tax-perscantage">{{tax.percentage}}</span>%)</p>
                                                <h6 class="amounts">₹ <span class="tax-amount"></span></h6>
                                            </div>
                                            {% endfor %}
                                        </div>

                                    </div>
                                </div>
                            </div>
                            <!-- Items Tab End -->

                            <!-- Payments Tab Start -->
                            <div class="tab-pane fade" id="payments" role="tabpanel" aria-labelledby="payments-tab">
                                <div class="card rounded-2 mt-4">
                                    <div class="card-body">
                                        <div class="d-flex justify-content-between">
                                            <p class="text-muted">Payment Status</p>

                                            <h6 id="payment-tab-payment-status" class="total-amount">

                                            </h6>
                                        </div>

                                        <div class="d-flex justify-content-between">
                                            <p class="text-muted" id="payment-tab-panding-amount-heading">Paid Amount
                                            </p>
                                            <h6 class="total-amount">₹ <span
                                                    id="payment-tab-panding-amount-value"></span>
                                            </h6>
                                        </div>

                                        <div class="d-flex justify-content-between">
                                            <p class="text-muted">Payment Method</p>
                                            <h6 class="total-amount" id="payment-method-value">
                                            </h6>
                                        </div>

                                        <div class="col-12 float-end text-end">
                                            <button class="btn btn-danger" id="refund-button" data-bs-toggle="modal"
                                                data-bs-target="#refund-order" style="cursor: pointer;">
                                                Refund Amount
                                            </button>

                                        </div>


                                    </div>
                                </div>
                                <!-- Repeat for other payments -->
                            </div>
                            <!-- Payments Tab End -->
                        </div>
                        <div class="row g-3">
                            <div class="container-fluid text-center pt-3">
                                <button class="btn btn-primary mx-2 mb-2" id="kot-button" order_id=""
                                    onclick="printKot(this)">Print KOT </button>
                                <button class="btn btn-primary mx-2 mb-2 d-none" id="bill-button" order_id=""
                                    onclick="printBill(this)">Print Bill </button>
                                <button class="btn btn-success mx-2 mb-2" onclick="deliverOrder()"
                                    id="order-deliver-button">Deliver
                                    Order</button>
                            </div>
                        </div>

                    </div>
                </div>

                <!-- order html ends here -->

            </div>
            <div class="modal-footer">

            </div>
        </div>
    </div>
</div>

<!-- refund items modal starts -->

<div class="modal fade" id="refund-items" tabindex="-1" role="dialog" aria-labelledby="refund-itemsTitle"
    aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="partialModalLabel">Partial Refund</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>

            </div>

            <div class="modal-body">
                <div class="card-title">
                    Select The Items Which You Want to Refund
                </div>

                <ul class="list-group" id="refunded-item-list">

                </ul>

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" id="partial-refund-btn-otp-popup">Get Refund</button>
            </div>
        </div>
    </div>
</div>

<!-- refudn items modal ends -->

<!-- refund modal -->

<div class="modal fade" id="refund-order" tabindex="-1" role="dialog" aria-labelledby="refund-orderTitle"
    aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Refund Amount</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>

            </div>
            <form action="" id="refudn-form" method="post">
                {% csrf_token %}
                <div class="modal-body">
                    <div class="card-title">
                        An OTP is send to your Theatre's registered phone number. Please enter the OTP to proceed with
                        the refund.
                    </div>

                    <div class="d-none">
                        <textarea name="items-to-refund" id="items-to-refund">
                        </textarea>
                    </div>

                    <div class="form-group">
                        <label for="otp" class="form-label">Enter Refund ID</label>
                        <input type="text" class="form-control" name="otp" id="otp" placeholder="Enter Refund ID"
                            required>
                    </div>

                    <div class="class-form-group">
                        <label for="reason" class="form-label">Enter a Reason for Refund</label>
                        <textarea name="reason" id="reason" rows="3" class="form-control" required></textarea>
                    </div>

                </div>
                <div class="modal-footer">
                    <button type="button" id="resend-otp-button" class="btn btn-secondary btn-custom">Resend
                        OTP</button>
                    <button type="submit" class="btn btn-primary">Submit</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- refund modal ends here -->


<div class="pageWrapper">
    <div class="container text-center theatreView mt-4">
        <h5 class="section-title ff-secondary text-center text-primary fw-normal">Theater Seat Order View</h5>
        <h5 class="mb-4">Total Pending Orders - <span id="total-pending-orders">0</span></h5>
        <div class="tab-class text-center wow fadeInUp mt-3" data-wow-delay="0.1s">
            <ul id="hall-list" class="nav nav-pills d-inline-flex justify-content-center border-bottom mb-5">

                <!-- li added by js -->

            </ul>
            <div id="all-hall-box" class="tab-content">

            </div>

            <!-- screen section -->
            <div class="cinema">
                <div class="screen-3d">
                </div>

            </div>
            <p class="mt-3">
                All eyes this way please!
            </p>
            <!-- Booking Info -->
            <ul class="info">
                <li><span class="seat"></span> Available Seats
                </li>
                <li><span class="seat paymentreceived"></span>Order and Payment Recieved
                </li>
                <li><span class="seat seen"></span>Order's Item Seen</li>
                <!-- <li><span class="seat orderreceived"></span>Cash Order and Payment Pending
                </li> -->
            </ul>
        </div>
    </div>

</div>

{{theatre.id|json_script:"theatre-id"}}

</div>

<script src="{% static 'theatre_js/menu-functionality.js' %}?v=20260211001"></script>
<script src="{% static 'theatre_js/menu.js' %}?v=20260211001"></script>
<script src="{% static 'theatre_js/cart.js' %}?v=20260211001"></script>
<script src="{% static 'theatre_js/all-seats.js' %}?v=20260211001"></script>
<script src="{% static 'theatre_js/order-profile.js' %}?v=20260211001"></script>
<script src="{% static 'theatre_js/all-seat-socket.js' %}?v=20260211001"></script>


{% endblock %}