{% extends "website/base.html" %}
{% load static %}
{% block title %}

<title>
  Order Status | {{order.seat.name}}
</title>
<link rel="stylesheet" href="{% static 'assets/css/order-preparing.css' %}">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css" rel="stylesheet">
<!-- Customized Bootstrap Stylesheet -->
<link href="{% static 'assets/css/bootstrap.min.css' %}" rel="stylesheet">

{% endblock %}

{% block body %}

{% load static %}
<!-- Navbar & Hero Start -->
<div class="container-xxl position-relative p-0">
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark px-4 px-lg-5 py-lg-0 nav-custom">
    <a href="" class="navbar-brand p-0">
      <a href="{% url 'website:index' %}" class="navbar-brand p-0">
        <img src="{% static 'assets/images/brand/Scan2Food.png' %}" alt="Scan2Food Logo">
      </a>
      <!-- <img src="assets/images/logo.png" alt="Logo"> -->
    </a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse">
      <span class="fa fa-bars"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarCollapse">
      <div class="navbar-nav ms-auto py-0 pe-4">
      </div>
  </nav>

</div>


<!-- Modal Structure -->
<div id="customModal" class="modal-overlay">
  <div class="modal-content">
    <form action="{% url 'theatre:raise-refund-request' order.pk %}" id="phone-number-form" method="post">
      {% csrf_token %}
      <h2>Please enter the same mobile number which you have added at time of order</h2>

      <input type="tel" maxlength="10" id="phone-number" name="phone-number" placeholder="Enter your phone number" />
      <button type="button" class="close-btn" onclick="closeModal()">Close</button>
      <button type="button" class="refund-button mx-1 my-1" onclick="submitPhone()">Submit</button>


    </form>
  </div>
</div>
<!-- MODAL ENDS HERE -->



<div class="stage-wrapper">
  <div class="stage">
    <!-- Cooking infographic -->
    <svg class="card card-3x2" viewBox="0 0 960 640" xmlns="http://www.w3.org/2000/svg" aria-labelledby="t3" role="img">
      <title id="t3">Your order is being freshly prepared</title>
      <g class="content">
        <g transform="translate(370,220)">
          <!-- stove base -->
          <rect x="0" y="60" width="220" height="40" rx="10" fill="var(--blue)" opacity=".9" />
          <!-- pot -->
          <rect x="80" y="20" width="60" height="40" rx="8" fill="var(--yellow)" />
          <rect x="70" y="16" width="80" height="10" rx="5" fill="var(--orange)" />
          <!-- steam -->
          <g fill="var(--orange)" opacity=".8">
            <path d="M110,10 q-6,-6 0,-12" class="steam-1" />
            <path d="M125,8 q-6,-6 0,-12" class="steam-2" />
            <path d="M95,8 q-6,-6 0,-12" class="steam-3" />
          </g>
          <!-- chef (minimal) -->
          <g transform="translate(-20,-10)">
            <circle cx="40" cy="10" r="16" fill="var(--yellow)" />
            <rect x="24" y="26" width="32" height="46" rx="10" fill="var(--yellow)" />
            <!-- chef hat -->
            <g fill="var(--blue)">
              <rect x="26" y="-10" width="28" height="10" rx="5" />
              <circle cx="32" cy="-16" r="6" />
              <circle cx="40" cy="-18" r="7" />
              <circle cx="48" cy="-16" r="6" />
            </g>
          </g>
        </g>
        <!-- radial bubbles moved to next row center -->
        <g transform="translate(480,320)">
          <circle cx="0" cy="0" r="12" fill="var(--yellow)" class="bubble-1"></circle>
          <circle cx="60" cy="20" r="10" fill="var(--orange)" class="bubble-2"></circle>
          <circle cx="-40" cy="55" r="12" fill="var(--yellow)" class="bubble-3"></circle>
        </g>
        <!-- Titles moved to next row center -->
        <g transform="translate(480,420)" text-anchor="middle">
          <text x="0" y="0" font-size="26" font-weight="800" fill="var(--yellow)"> Your Food Being prepared
          </text>
          <text x="0" y="40" font-size="20" font-weight="700" fill="var(--blue)">Sit back and relax</text>
        </g>
      </g>
    </svg>

    <!-- Countdown & copy -->
    <div class="meta">
      <div class="timerWrap">
        <svg class="ring" viewBox="0 0 120 120" xmlns="http://www.w3.org/2000/svg" width="50" height="50">
          <defs>
            <linearGradient id="g2" x1="0" y1="0" x2="1" y2="1">
              <stop offset="0%" stop-color="var(--yellow)" />
              <stop offset="100%" stop-color="var(--orange)" />
            </linearGradient>
          </defs>
          <circle cx="60" cy="60" r="52" fill="none" stroke="#e6eaf3" stroke-width="8" opacity=".45" />
          <circle id="pg2" cx="60" cy="60" r="52" fill="none" stroke="url(#g2)" stroke-width="10" stroke-linecap="round"
            transform="rotate(-90 60 60)" stroke-dasharray="327" stroke-dashoffset="0" />
        </svg>
      </div>
      <span class="sub">
        <svg class="clock clock--small" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
          <circle cx="12" cy="12" r="9" fill="none" stroke="var(--blue)" stroke-width="2" />
          <line x1="12" y1="12" x2="12" y2="6" stroke="var(--orange)" stroke-width="2" stroke-linecap="round" />
          <line x1="12" y1="12" x2="17" y2="12" stroke="var(--blue)" stroke-width="2" stroke-linecap="round" />
        </svg>
        Estimated wait <span id="eta2b">
        </span>
      </span>
    </div> <!-- end .meta -->
    <button class="btn btn-success" id="refresh-button" onclick="window.location.reload()">
      Refresh Status
    </button>


    <!-- new: refund claim line displayed after the meta block -->
    <div class="refund-claim" role="region" aria-hidden="false" id="button-area">
      <p class="refund-copy"></p>

    </div>
  </div>
</div>

{{order.seat.row.hall.theatre.query_number|json_script:"query-number"}}

{{order.payment.phone_number|json_script:"customer-mobile-number"}}
{{order.seat.row.hall.theatre.download_invoice|json_script:"download_invoice"}}
{{order.pk|json_script:"order-id"}}
<script src="{% static 'theatre_js/order-preparing.js' %}"></script>

{% if request.user.is_authenticated and request.user.userprofile.theatre %}
<!-- Theatre owner is logged in - show ONLY 10-second redirect countdown (common screen) -->
{{ order.seat.row.hall.theatre.pk|json_script:"theatre-id"}}
<script src="{% static 'theatre_js/redirect-url.js' %}"></script>
<script>
  // Start 10-second redirect countdown for theatre owners
  startRedirectCountdown();
</script>
{% else %}
<!-- Regular customer - show ONLY estimated preparation time -->
<script>
  // Show estimated preparation time for customers
  startCountdown("{{order_time}}", parseInt("{{max_time}}"));
</script>
{% endif %}

{% endblock %}